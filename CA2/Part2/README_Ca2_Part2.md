# Class Assignment 2 part 2

## Introduction

For the second part of this Class Assignment , the goal is to implement a series of changes to a Gradle project. The changes involve adding a frontend plugin to the project, adding a task to copy the generated Jar file, and adding a task to delete the files generated by the webpack.
The changes will be implemented in a new branch called "tut-basic-gradle" and then merged to the master branch. 
The steps to implement the changes are detailed below.

## Table of Contents

1. [Introduction](#Introduction)
2. [Implementing Features](#Implementing-Features)
   - [Part 1: Adding the frontend plugin](#Part-1-Adding-the-frontend-plugin)
   - [Part 2: Adding the copyJar task](#Part-2-Adding-the-copyJar-task)
   - [Part 3: Adding the deleteWebpackFiles task](#Part-3-Adding-the-deleteWebpackFiles-task)
   - [Part 4: Merging the branches](#Part-4-Merging-the-branches)
3.[Alternative solution](#Alternative-solution)
4[Conclusion](#Conclusion)


## Introduction

Before starting to implement the new features, it is necessary to create a new branch in the repository. To do so, follow these steps:

```bash
git branch tut-basic-gradle
git checkout tut-basic-gradle
```

1. Click on the following link: [Spring Initializr](https://start.spring.io/), and create a new project with the following configurations:
   - Project: Gradle Project
   - Language: Java
   - Spring Boot: 2.6.3
   - Project Metadata:
     - Group: com.example
     - Artifact: demo
     - Name: demo
     - Package Name: com.example.demo
   - Dependencies: Web, JPA, H2, Thymeleaf


2. After you set all the correct settings, use Generate to download the project.

3. Delete source folder  and copy the one from CA1Part1 assignment
```bash
rm -r  ~/OneDrive/Ambiente de Trabalho/11_04_2024_DevOps/CA2/Part2/react-and-spring-data-rest-basic/src
cp -r ~/OneDrive/Ambiente\ de\ Trabalho/11_04_2024_DevOps/CA1/Part1/react-and-spring-data-rest-basic/src ~/OneDrive/Ambiente\ de\ Trabalho/11_04_2024_DevOps/CA2/Part2/react-and-spring-data-rest-basic/
```

5. Copy the **webpack.config.js** and the **package.json** files from CA1 Part 1 to the current package folder.
```bash
cp ~/OneDrive/Ambiente\ de\ Trabalho/11_04_2024_DevOps/CA1/Part1/react-and-spring-data-rest-basic/webpack.config.js ~/OneDrive/Ambiente\ de\ Trabalho/11_04_2024_DevOps/CA2/Part2/react-and-spring-data-rest-basic/
cp ~/OneDrive/Ambiente\ de\ Trabalho/11_04_2024_DevOps/CA1/Part1/react-and-spring-data-rest-basic/package.json ~/OneDrive/Ambiente\ de\ Trabalho/11_04_2024_DevOps/CA2/Part2/react-and-spring-data-rest-basic/
```
6. Delete built folder.
```bash
rm -r ~/OneDrive/Ambiente\ de\ Trabalho/11_04_2024_DevOps/CA2/Part2/react-and-spring-data-rest-basic/src/main/resources/static/built
```
7. In the **Employee.java** class, change all *javax.persistence* imports to *jakarta.persistence*.
Implemented this correction after receiving message from the teacher via Teams.

## Implementing Features
### Part 1: Implementing the frontend plugin

Now we will add the frontend plugin to the project. Please follow these steps:

1. In the build.gradle file, add the plugin to the plugins section:
```gradle
 id "org.siouan.frontend-jdk17" version "8.0.0"
```

2. Now add the following configuration to the build.gradle file, after the plugins section:
```gradle
 frontend {
nodeVersion = "16.20.2"
assembleScript = "run build"
cleanScript = "run clean"
checkScript = "run check"
}
```

3. Add the scripts section to the build.gradle file, after the frontend section:
```gradle
"scripts": {
"webpack": "webpack",
"build": "npm run webpack",
"check": "echo Checking frontend",
"clean": "echo Cleaning frontend",
"lint": "echo Linting frontend",
"test": "echo Testing frontend"
},
```
4. Following line to the package.json file, after the "scripts" section:
```gradle
"packageManager": "npm@9.6.7",
```

5. After positioning yourself in the project folder, compile the project in the terminal by running the following command:
```bash
cd ~/OneDrive/Ambiente\ de\ Trabalho/11_04_2024_DevOps/CA2/Part2/react-and-spring-data-rest-basic
./gradlew build
```

6. In order to strat the project execute the following command in the same location:
```bash
./gradlew bootRun
```

### Part 2: Adding the copyJar task

For this part of the assignment, a new task will be added to copy the generated Jar file. The steps to take so are:

1. In the build.gradle file, add the following task:
```gradle
task copyJar(type: Copy, dependsOn: build) {
	from 'build/libs/'
	into 'dist'
	include '*.jar'
}
```

2. After positioning yourself in the project folder, compile the project in the terminal by running the following command:
```bash
cd ~/OneDrive/Ambiente\ de\ Trabalho/11_04_2024_DevOps/CA2/Part2/react-and-spring-data-rest-basic
./gradlew build
```
3. Add all te files to the staging area:
```bash
git add .
```
4. Commit the changes with a message that describes the changes made to the project:
```bash
git commit -m "[feat]: Add copy jar task Fixes #34"
```
5. Push the changes to the repository:
```bash
git push
```

### Part 3: Adding the deleteWebpackFiles task

The goal for the third part of the assignment is to add a task to delete the files generated by the webpack. The steps to take so are:

1. In the build.gradle file, add the following task:
```gradle
task deleteWebpackFiles(type: Delete) {
	delete 'src/main/resources/static/built'
}
```

2. This command will make the clean task depend on the deleteWebpackFiles task. Add the following line to the build.gradle file:
```gradle
clean.dependsOn(deleteWebpackFiles)
```

3. After positioning yourself in the project folder, compile the project in the terminal by running the following command:
```bash
cd ~/OneDrive/Ambiente\ de\ Trabalho/11_04_2024_DevOps/CA2/Part2/react-and-spring-data-rest-basic
./gradlew build
```
4. Add all te files to the staging area:
```bash
git add .
```
5. Commit the changes:
```bash
git commit -m "Added the following task: deleteWebpackFiles"
```
6. Push the changes to the repository:
```bash
git push
```
### Part 4: Merging the branches

After the features are verified, we need to merge to the master branch. To do so, follow these steps:
1. Switch to the master branch:
```bash
git checkout master
```
2. Merge the tut-basic-gradle branch:
```bash
git merge --no-ff tut-basic-gradle
```
3. Push the changes to the repository:
```bash
git push
```

## Alternative solution
We could have executed the previous steps using Maven as the build automation tool. The steps to implement the changes using Maven would be the following:
Note: I unlighted the different steps between the two solutions.

1. Create a new module for the Part2_1_Maven where we will produce the new features:
```bash
cd  ~/OneDrive/Ambiente de Trabalho/11_04_2024_DevOps/CA2
mkdir Part2_1_Maven
```
2. Added the front-end plug in:
```xml
<plugin>
    <groupId>com.github.eirslett</groupId>
    <artifactId>frontend-maven-plugin</artifactId>
    <version>1.9.1</version>
    <configuration>
        <installDirectory>target</installDirectory>
    </configuration>
    <executions>
        <execution>
            <id>install node and npm</id>
            <goals>
                <goal>install-node-and-npm</goal>
            </goals>
            <configuration>
                <nodeVersion>v12.14.0</nodeVersion>
                <npmVersion>6.13.4</npmVersion>
            </configuration>
        </execution>
        <execution>
            <id>npm install</id>
            <goals>
                <goal>npm</goal>
            </goals>
            <configuration>
                <arguments>install</arguments>
            </configuration>
        </execution>
        <execution>
            <id>webpack build</id>
            <goals>
                <goal>webpack</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

3. Add the task to copy the generated Jar file:
```xml
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-resources-plugin</artifactId>
  <version>3.2.0</version>
  <executions>
    <execution>
      <id>copy-jar</id>
      <phase>package</phase>
      <goals>
        <goal>copy-resources</goal>
      </goals>
      <configuration>
        <outputDirectory>${project.basedir}/dist</outputDirectory>
        <resources>
          <resource>
            <directory>${project.build.directory}</directory>
            <includes>
              <include>*.jar</include>
            </includes>
          </resource>
        </resources>
      </configuration>
    </execution>
  </executions>
</plugin>
```

4. Add the task to delete the files generated by the webpack:
```xml
<plugin>
  <artifactId>maven-clean-plugin</artifactId>
  <version>3.1.0</version>
  <configuration>
    <filesets>
      <fileset>
        <directory>${project.basedir}/src/main/resources/static/built</directory>
        <includes>
          <include>**/*</include>
        </includes>
      </fileset>
    </filesets>
  </configuration>
</plugin>
```

4. Compile the project:
```bash
$ ./mvnw compile
```

5. Run the project:
```bash
$ ./mvnw spring-boot:run
```

6. Open the browser in the port 8080 to check the project:

6. Package the project (and copy the generated Jar file):
```bash
$ ./mvnw package
```

7. Clean the project:
```bash
$ ./mvnw clean
```

8. Commit and push the changes.
```bash
git add .
git commit -m "[feat]: add maven implementation Fixes #39"
git push
```

The above steps provide a way to implement the changes using Maven as the build automation tool. The steps are similar to the ones used with Gradle.
The main difference is the configuration of the plugins in the pom.xml file.

## Conclusion
During the class assignment a number of issues were created in order to implement the changes to the project. The changes involved adding a frontend plugin to the project, adding a task to copy the generated Jar file, and adding a task to delete the files generated by the webpack. The changes were implemented in a new branch called "tut-basic-gradle" and then merged to the master branch. The steps to implement the changes were detailed in the README file. 
An alternative solution was also provided, showing how to implement the changes using Maven as the build automation tool.